#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "estudiante.h"

void guardarEstudianteCSV(const Estudiante *estudiante, FILE *archivo) {
    fprintf(archivo, "%d,%s,%s\n", estudiante->id, estudiante->nombre, estudiante->fechaNacimiento);
}

Estudiante* cargarEstudianteCSV(FILE *archivo) {
    Estudiante *estudiante = (Estudiante*)malloc(sizeof(Estudiante));
    if (fscanf(archivo, "%d,%[^,],%[^\n]\n", &estudiante->id, estudiante->nombre, estudiante->fechaNacimiento) == 3) {
        estudiante->materias = crearLista();
        return estudiante;
    } else {
        free(estudiante);
        return NULL;
    }
}

void guardarListaEstudiantesCSV(const Lista *lista, const char *nombreArchivo) {
    FILE *archivo = fopen(nombreArchivo, "w");
    if (archivo == NULL) {
        printf("Error al abrir el archivo %s\n", nombreArchivo);
        return;
    }

    Nodo *nodo = lista->cabeza;
    while (nodo != NULL) {
        guardarEstudianteCSV((Estudiante*)nodo->data, archivo);
        nodo = nodo->proximo;
    }

    fclose(archivo);
}

Lista* cargarListaEstudiantesCSV(const char *nombreArchivo) {
    Lista *lista = crearLista();
    FILE *archivo = fopen(nombreArchivo, "r");
    if (archivo == NULL) {
        printf("Error al abrir el archivo %s\n", nombreArchivo);
        return lista;
    }

    Estudiante *estudiante;
    while ((estudiante = cargarEstudianteCSV(archivo)) != NULL) {
        agregar(lista, estudiante);
    }

    fclose(archivo);
    return lista;
}
